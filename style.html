<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>STYLE TTRANSFER</title>
       <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <style type="text/css">
    .imgtest{margin:10px 5px;
    overflow:hidden;}
    .list_ul figcaption p{
    font-size:12px;
    color:#aaa;
    }
    .imgtest figure div{
display:inline-block;
margin:5px auto;
width:100px;
height:100px;
border-radius:100px;
border:2px solid #fff;
overflow:hidden;
-webkit-box-shadow:0 0 3px #ccc;
box-shadow:0 0 3px #ccc;
}
    .imgtest img{width:100%;
    min-height:100%; text-align:center;}


    </style>
</head>
<body>
 <div id="Layer1" style="position:absolute; width:100%; height:100%; z-index:-1">
<img src="background/beijing.jpg" height="2500px" width="100%"/>
</div>
<div class="container">
	<div class="row clearfix">
		<div class="col-md-12 column">
			<div class="panel panel-warning">
    <div class="panel-heading">
        <h3 class="panel-title">STYLE TRANSFER QL</h3>
    </div>
    <div class="panel-body">
       <div >
    <label class="btn btn-primary">
        <a href="main.html" class="btn btn-primary btn-lg" role="button">各图片风格展示</a>
    </label>
    <label class="btn btn-primary">
        <a href="style.html" class="btn btn-primary btn-lg" role="button">图片风格转换</a>
    </label>
</div>
    </div>
</div>
</div>
    </div>
<br>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-warning">
            <div class="panel-heading">
                <h3 class="panel-title">CONTENT</h3>
            </div>
            </div>
            <br>
              <div  style="text-align: center; width: 100%" >
                 <img src='background/haha.jpg' id="content" class="img-circle">
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-warning">
            <div class="panel-heading">
                <h3 class="panel-title">STYLE</h3>
            </div>
            </div>
            <br>
    </div>
        <div  style="text-align: center; width: 100%" >
                 <img src='background/haha.jpg' id="style" class="img-circle">
            </div>
        </div>

    <div class="row">
        <div class="col-md-4">
            <input type="file" onchange="loadContent(this)">
        </div>
        <div class="col-md-2">
        </div>
        <div class="col-md-4">
            <input type="file" onchange="loadStyle(this)">
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col-md-2">
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon3">train</span>
                <input type="text" class="form-control" id="train"
                       aria-describedby="basic-addon3" placeholder="200">
            </div>
        </div>
        <div class="col-md-2">
          <INPUT TYPE="button" value='Transfer' onclick="reP()">
        </div>
        <div class="col-md-8" style="transform: translateY(30%);">
            <img src='image/1_fugu.png' id="oImg" style='display:none' >
        </div>
    </div>
    <br>
</div>

 <SCRIPT LANGUAGE="JavaScript">
    function reP(){
    document.getElementById('oImg').style.display = "block";
    }
    var content = $('#content').attr('src');
    var style = $('#style').attr('src');
    var time = 0;
    $('#run').click(function (e) {
        e.preventDefault();
        alert("It make take a few minutes, please wait.");
        var sitv = setInterval(function(){
            $.ajax({
                url: '/api/v1/progress',
                type: 'get',
                success: function (json) {
                    json = JSON.parse(json);
                    time = Number(json['prog']);
                    $("#prog").css("width",time + "%").text(time + "%");
                    document.getElementById('mix').src = json['mix_img'];
                }
            });
        }, 5000);
        var train = $('#train').val();
        if(train.length === 0){
            train = '20';
        }
        $.ajax({
            url: '/api/v1/mix',
            type: 'post',
            data: {'content': content,
                    'style':style,
                    'train': train},
            success: function (json) {
                clearInterval(sitv);
                json = JSON.parse(json);
                time = 100;
                $("#prog").css("width",time + "%").text(time + "%");
                document.getElementById('gif').src = json['gif'];
                document.getElementById('mix').src = json['mix_img'];
                alert('ok');
            }
        });
    });
    function loadContent(file) {
        if (!file.files || !file.files[0]) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function (evt) {
            document.getElementById('content').src = evt.target.result;
            content = 'content/' + file.files[0].name;
        };
        reader.readAsDataURL(file.files[0]);
    }
    function loadStyle(file) {
        if (!file.files || !file.files[0]) {
            return;
        }
        var reader = new FileReader();
        reader.onload = function (evt) {
            document.getElementById('style').src = evt.target.result;
            style = 'style/' + file.files[0].name;
        };
        reader.readAsDataURL(file.files[0]);
    }
</script>
</body>
</html>